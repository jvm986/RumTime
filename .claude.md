# RumTime - Claude Code Context

## Project Overview

RumTime is a SwiftUI-based iOS timer app for Rummy and Rummikub card games. It provides turn-based timing with player rotation, bonus time allocation, and score tracking across multiple rounds.

**Technology Stack:**
- SwiftUI (iOS app)
- Swift 6.0
- SwiftData for persistence
- Modern @Observable and @Model macros
- AVFoundation for audio alerts

**Target iOS Version:** iOS 26.1+
**Deployment Target:** iPhone and iPad

---

## Architecture

### App Structure
- **MVVM pattern** with SwiftUI Views and SwiftData Models
- **Persistence:** SwiftData with ModelContainer and ModelContext
- **State management:** `@State`, `@Binding`, `@Query` for reactive UI
- **Models:** @Model classes with automatic persistence

### Key Models
- **`Game`**: @Model class representing a game session with cascade delete rules and theme color
- **`Player`**: @Model class for individual players with theme colors (was nested in Game)
- **`Round`**: @Model class for completed rounds with cascade delete for scores
- **`Score`**: @Model class for individual scores (was nested in Round)
- **`RoundTimer`**: `@MainActor` `@Observable` class managing active timer (not persisted)
- **`Theme`**: Enum for color schemes used by games and players
- **`AppLogger`**: Centralized logging utility with categorized loggers

### View Hierarchy
```
RumTimeApp
└── NavigationView
    └── GamesView (list of games)
        └── DetailView (game details)
            ├── DetailEditView (edit game settings)
            ├── RoundTimerView (active timer display)
            └── ScoreView (record round scores)
```

---

## Code Conventions

### Swift Style
- **Indentation:** 4 spaces
- **Naming:** camelCase for variables/functions, PascalCase for types
- **Access control:** Use `private` liberally, `private(set)` for read-only published properties
- **Optionals:** Prefer guard/if-let over force unwrapping (fix any existing force unwraps)

### SwiftUI Patterns
- Use `@State` for view-owned state
- Use `@Observable` for non-persisted observable objects (RoundTimer)
- Use `@Model` for persisted SwiftData objects
- Use `@Query` for fetching SwiftData models
- Use `@Binding` for two-way data flow
- Use `@Environment(\.modelContext)` for CRUD operations
- Prefer composition over large monolithic views
- Use view extensions for reusable modifiers

### File Organization
- Models in `/Models` directory
- Views at root level
- One type per file when possible
- Related extensions can be in the same file

---

## Important Context

### Timer Implementation
The `RoundTimer` is a `@MainActor` class that:
- Uses `Timer.scheduledTimer` with 100Hz frequency for smooth updates
- Tracks elapsed time since `startDate`
- Plays alarm sound via shared `AVPlayer` at 5 seconds remaining
- Shows alert when time expires
- Applies bonus time after each turn

**Key behaviors:**
- Timer pauses when app goes to background
- Can pause mid-round and resume
- Each player gets bonus time added after their turn completes
- Players can be paused (sit out) during a game

### Data Persistence
**Migrated to SwiftData (November 2025)**

The app previously used JSON file-based persistence but was migrated to SwiftData for better reliability and performance.

**SwiftData Architecture:**
- ModelContainer configured in RumTimeApp.swift with full schema
- In-memory storage for testing, persistent storage for production
- @Query property wrapper for automatic fetch and updates
- ModelContext for CRUD operations with automatic saves
- Cascade delete rules ensure data integrity

**Key Changes from JSON:**
- Nested structs (Game.Player, Round.Score) became top-level @Model classes
- ObservableObject replaced with @Observable macro
- @Published properties removed (automatic with @Observable)
- Manual save calls eliminated (SwiftData auto-saves)
- GameStore removed (ModelContext handles persistence)

### Known Issues
1. ~~**Accessibility bug:** `GamesView.swift:37` has "New Scrum" label~~ ✅ Fixed
2. ~~**No tests:** Zero test coverage~~ ✅ Comprehensive test suite implemented
3. ~~**JSON persistence:** Unreliable file-based storage~~ ✅ Migrated to SwiftData
4. **Force unwrapping:** Should audit and remove where possible
5. **No localization:** All strings hardcoded in English

---

## Development Workflow

### When Making Changes

1. **Always read files before editing** - Check current implementation first
2. **Preserve existing patterns** - Match the established code style
3. **Update ROADMAP.md** - Check off completed tasks
4. **Test on device/simulator** - Especially timer functionality
5. **Consider accessibility** - Add labels, hints, and VoiceOver support

### Testing Strategy
**Current Status:** Comprehensive test suite with unit and UI tests, all passing

**Test Coverage:**
- `GameTests.swift` - Game model, player management, rounds, scoring
- `RoundTimerTests.swift` - Timer lifecycle, turn management, async behavior
- `PersistenceTests.swift` - SwiftData persistence, cascade deletes, queries
- `RumTimeUITests.swift` - Full app flow from creation to deletion

**Migration from GameStoreTests:**
- Replaced JSON-based GameStoreTests with SwiftData PersistenceTests
- All tests updated for @Model classes and ModelContext
- Added @MainActor to test classes for SwiftData compatibility

### Commit Message Style
- **Use single-line commit messages** - Keep them concise and descriptive
- Format: `Brief description of changes`
- Example: `Complete Phase 1.2 with UI tests and 79% code coverage`

### Before Committing
- [ ] Build succeeds without warnings
- [ ] No SwiftLint violations (once configured)
- [ ] New features have tests
- [ ] Accessibility labels added
- [ ] ROADMAP.md updated

---

## Common Patterns

### Creating a New Game (SwiftData)
```swift
let newGame = Game(data: gameData)
modelContext.insert(newGame)
// Auto-saves, no manual save needed
```

### Adding a Round (SwiftData)
```swift
game.addRound(from: roundData)
// Auto-saves, no manual save needed
```

### Deleting Objects (SwiftData)
```swift
modelContext.delete(game)
// Cascade deletes players and rounds automatically
```

### Timer Lifecycle
```swift
roundTimer.reset(startingTime:turnBonus:players:starter:)
roundTimer.startRound()  // begins timing
roundTimer.endTurn()     // next player
roundTimer.pauseRound()  // suspend
roundTimer.unpauseGame() // resume
```

---

## Key Files Reference

### Core App
- `RumTimeApp.swift` - App entry point, manages GameStore
- `GamesView.swift` - Main list of games
- `DetailView.swift` - Individual game view with round management

### Models
- `Models/Game.swift` - @Model Game class with cascade delete rules
- `Models/Player.swift` - @Model Player class (formerly nested in Game)
- `Models/Round.swift` - @Model Round class with cascade delete
- `Models/Score.swift` - @Model Score class (formerly nested in Round)
- `Models/RoundTimer.swift` - @Observable timer logic (not persisted)
- `Models/Theme.swift` - Color scheme enum
- `Models/Logger.swift` - Centralized logging utility
- `Models/AVPlayer.swift` - Shared audio player extension

### Timer Views
- `RoundTimerView.swift` - Full-screen timer during play
- `GameTimerView.swift` - Circular timer visualization
- `GameFooterView.swift` - Next player display
- `TimeView.swift` - Time display component
- `PlayerArc.swift` - Progress arc visualization

### Supporting Views
- `GameCardView.swift` - Game list item
- `DetailEditView.swift` - Game settings editor
- `ScoreView.swift` - Score entry form
- `ErrorView.swift` - Error presentation

### Tests
- `RumTimeTests/GameTests.swift` - 9 tests for Game model with SwiftData
- `RumTimeTests/RoundTimerTests.swift` - 17 tests for timer logic
- `RumTimeTests/PersistenceTests.swift` - 7 tests for SwiftData persistence
- `RumTimeUITests/RumTimeUITests.swift` - 1 comprehensive UI test

---

## App Store Context

This project is being prepared for:
1. **App Store submission** - Follow Apple guidelines strictly
2. **Portfolio showcase** - Code quality and documentation are priorities
3. **Public release** - User experience and polish are critical

### Compliance Considerations
- No data collection (privacy-friendly)
- Local storage only (no backend)
- All ages appropriate
- Accessibility required
- Localization desired (future)

---

## Future Considerations

### Planned Improvements (see ROADMAP.md)
- Comprehensive test suite
- Accessibility enhancements
- Onboarding flow
- Help documentation
- Export functionality
- iPad optimization

### Potential Features
- iCloud sync
- Apple Watch app
- Widgets
- Custom themes
- Multiplayer sync

---

## Working with This Project

### What to Prioritize
1. **Code quality** over speed - this is a portfolio piece
2. **Accessibility** from the start - not as an afterthought
3. **Testing** everything - build confidence in the codebase
4. **Documentation** as you go - explain complex logic
5. **User experience** polish - smooth, delightful interactions

### What to Avoid
- Breaking existing functionality without tests
- Adding features before fixing known issues
- Force unwrapping optionals
- Hardcoding values that should be configurable
- Skipping accessibility considerations
- Committing without updating ROADMAP.md

---

## Questions or Clarifications

If you're unsure about:
- **Architecture decisions:** Ask before making significant structural changes
- **UX changes:** Confirm design direction for user-facing changes
- **Breaking changes:** Discuss impact on existing games/data
- **Dependencies:** Avoid adding external dependencies without discussion

---

## Helpful Commands

```bash
# Build project
xcodebuild -project RumTime.xcodeproj -scheme RumTime build

# Run tests
xcodebuild test -project RumTime.xcodeproj -scheme RumTime -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0'

# Run tests in Xcode
# Press Cmd+U or Product > Test

# Check for warnings
xcodebuild -project RumTime.xcodeproj -scheme RumTime clean build | grep warning
```

---

## Contact & Resources

**Repository:** https://github.com/jvm986/RumTime
**Developer:** James Maguire
**Started:** October 2022
**Portfolio Prep Started:** November 2025

**Useful Links:**
- [Human Interface Guidelines](https://developer.apple.com/design/human-interface-guidelines/)
- [SwiftUI Documentation](https://developer.apple.com/documentation/swiftui)
- [App Store Review Guidelines](https://developer.apple.com/app-store/review/guidelines/)
- [Accessibility Programming Guide](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/iPhoneAccessibility/)
